# Pages 120-159 Notes

## Chapters/Sections Covered
- **Chapter 11: The Phonetic Component** (pages 108-122)
  - 11.1 Overview
  - 11.1.1 "Stored prosodics" synthesis
  - 11.1.2 Structure of PHONET
  - 11.1.3 History of formant synthesis-by-rule
  - 11.2 "Synthesis-by-analysis" of consonant-vowel syllables
  - 11.2.1 Analysis of CV syllables
  - 11.2.2 Synthesis strategy
  - 11.2.3 Intelligibility evaluation
  - 11.3 General rules for the synthesis of phonetic sequences
  - 11.3.1 Vowels
  - 11.3.2 Consonants
  - 11.3.3 Structure of the output parameter file
  - 11.4 Summary
- **Chapter 12: The Klatt Formant Synthesizer** (pages 123-147+)
  - 12.1 Overview
  - 12.1.1 Software simulation vs. hardware construction
  - 12.1.2 Formant synthesis vs. articulatory synthesis
  - 12.1.3 Cascade vs. parallel
  - 12.1.4 Waveform sampling rate
  - 12.1.5 Parameter update rate
  - 12.1.6 Digital resonators
  - 12.1.7 Digital antiresonator
  - 12.1.8 Low-pass resonator
  - 12.1.9 Synthesizer block diagram
  - 12.1.10 Sources of sound
  - 12.1.11 Voicing source
  - 12.1.12 Normal voicing
  - 12.1.13 Quasi-sinusoidal voicing
  - 12.1.14 Frication source
  - 12.1.15 Aspiration source
  - 12.1.16 Pitch-synchronous updating of voicing source amplitudes
  - 12.1.17 Generation of plosive bursts with a predictable spectrum
  - 12.1.18 Control of fundamental frequency
  - 12.2 Vocal tract transfer functions
  - 12.2.1 Cascade vocal tract model
  - 12.2.2 Relationship to analog models of the vocal tract
  - 12.2.3 Formant frequencies
  - 12.2.4 Formant bandwidths
  - 12.2.5 Nasals and nasalization of vowels
  - 12.2.6 Parallel vocal tract model for frication sources
  - 12.2.7 Simulation of the cascade configuration by the parallel configuration

## Key Findings

- **PHONET** accepts F0TARG input (phoneme array, stress, duration, F0 targets) and outputs 20 synthesizer control parameters every 5 msec
- Intelligibility: CV syllables achieved 99% vowel identification, 95% consonant identification
- **Locus theory**: Formant values at voicing onset fall on straight lines - F1 at voicing onset can be as high as 500 Hz before low vowels
- Consonants take on different characteristics depending on whether following vowel is front, back unrounded, or back rounded
- **DISCON transition**: No smoothing between segments (discontinuous)
- **SETSMO transition**: Smooth transition with settable boundary values (BVf forward, BVb backward)
- **SMODIS transition**: Smooth onset, discontinuous offset
- **DISSMO transition**: Discontinuous onset, smooth offset
- The Klatt synthesizer consists of two modules: **CWTRAN** (coefficient calculation) and **COEWAV** (waveform generation)
- Parameter update every 5 msec is sufficient for fast formant transitions and plosive bursts
- Digital sampling rate: 10,000 samples/second (10 kHz)
- Cascade configuration is better for vowels/sonorants; parallel needed for fricatives/plosives
- Normal voicing spectrum: -12 dB/octave; quasi-sinusoidal: -24 dB/octave
- Frication source: pseudo-random noise, -6 dB/octave low-pass filter
- Amplitude modulation for voiced fricatives: 50% modulation depth, square wave at F0
- Five formant resonators appropriate for 17 cm male vocal tract; female may need only 4
- Nasalization: Increase F1 by ~100 Hz, set nasal zero FNZ to average of new F1 and 270 Hz (fixed nasal pole)

## Equations Found

### Digital Resonator Difference Equation (Eq. 1, p. 128)
$$y(nT) = Ax(nT) + By(nT-T) + Cy(nT-2T)$$

Where:
- $y(nT)$ = output sample
- $x(nT)$ = input sample
- $y(nT-T)$, $y(nT-2T)$ = previous output samples
- $A$, $B$, $C$ = difference equation coefficients

### Resonator Coefficients (Eq. 2, p. 128)
$$C = -e^{2\pi BWT}$$
$$B = 2e^{-\pi BWT}\cos(2\pi fT)$$
$$A = 1 - B - C$$

Where:
- $T$ = 0.0001 seconds (reciprocal of 10 kHz sampling rate)
- $BW$ = bandwidth in Hz
- $f$ = resonant frequency in Hz

### Digital Resonator Transfer Function (Eq. 3, p. 128)
$$T(f) = \frac{A}{1 - Bz^{-1} - Cz^{-2}}$$

Where $z = e^{j2\pi fT}$, $j$ = sqrt(-1), $f$ = frequency in Hz

### Antiresonator Difference Equation (Eq. 4, p. 130)
$$y(nT) = A'x(nT) + B'x(nT-T) + C'x(nT-2T)$$

### Antiresonator Coefficients (Eq. 5, p. 130)
$$A' = 1/A$$
$$B' = -B/A$$
$$C' = -C/A$$

### Cascade Vocal Tract Transfer Function (Eq. 6, p. 140)
$$T(f) = \prod_{n=1}^{5} \frac{A(n)}{1 - B(n)z^{-1} - C(n)z^{-2}}$$

### Laplace Transform Formulation (Eq. 7, p. 140)
$$T(f) = \prod_{n=1}^{5} \frac{s(n)s^*(n)}{[s+s(n)][s+s^*(n)]}$$

Where:
- $s = j2\pi f$
- $s(n) = \pi BW(n) + j2\pi F(n)$
- $s^*(n) = \pi BW(n) - j2\pi F(n)$

## Parameters Found

| Name | Symbol | Units | Default | Range | Notes |
|------|--------|-------|---------|-------|-------|
| Amplitude of voicing | AV | dB | 0 | 0-80 | 60 dB for strong vowel |
| Amplitude of frication | AF | dB | 0 | 0-80 | 60 for strong fricative |
| Amplitude of aspiration | AH | dB | 0 | 0-80 | Sent to cascade branch |
| Amplitude of sinusoidal voicing | AVS | dB | 0 | 0-80 | For breathy voice |
| Fundamental frequency | F0 | Hz | 500 | 0-500 | Males ~100-200 Hz |
| First formant frequency | F1 | Hz | 500 | 150-900 | 180-750 Hz typical range |
| Second formant frequency | F2 | Hz | 1500 | 500-2500 | 600-2300 Hz typical |
| Third formant frequency | F3 | Hz | 2500 | 1300-3500 | 1300-3100 Hz typical |
| Fourth formant frequency | F4 | Hz | 3300 | 2500-4500 | Often held constant |
| Nasal zero frequency | FNZ | Hz | 250 | 200-700 | ~270 Hz for nasalization |
| Nasal formant amplitude | AN | dB | 0 | 0-80 | For parallel nasal branch |
| First formant amplitude | A1 | dB | 0 | 0-80 | Parallel branch |
| Second formant amplitude | A2 | dB | 0 | 0-80 | Parallel branch |
| Third formant amplitude | A3 | dB | 0 | 0-80 | Parallel branch |
| Fourth formant amplitude | A4 | dB | 0 | 0-80 | Parallel branch |
| Fifth formant amplitude | A5 | dB | 0 | 0-80 | Parallel branch |
| Sixth formant amplitude | A6 | dB | 0 | 0-80 | Parallel branch (~6 kHz) |
| Bypass path amplitude | AB | dB | 0 | 0-80 | For FF, VV, TH, DH, etc. |
| First formant bandwidth | B1 | Hz | 50 | 40-500 | Wider during consonants |
| Second formant bandwidth | B2 | Hz | 70 | 50-500 | |
| Third formant bandwidth | B3 | Hz | 110 | 50-500 | |
| Cascade/parallel switch | SW | - | 0 | 0(c)/1(p) | 0=cascade, 1=parallel only |
| Glottal resonator 1 frequency | FGP | Hz | 0 | 0-600 | For voicing source shaping |
| Glottal resonator 1 bandwidth | BGP | Hz | 100 | 100-2000 | |
| Glottal zero frequency | FGZ | Hz | 0 | 0-5000 | |
| Glottal zero bandwidth | BGZ | Hz | 6000 | 0-9000 | |
| Fourth formant bandwidth | B4 | Hz | 250 | 100-500 | |
| Fifth formant frequency | F5 | Hz | 3850 | 3500-4900 | |
| Fifth formant bandwidth | B5 | Hz | 200 | 150-700 | |
| Sixth formant frequency | F6 | Hz | 4900 | 4000-4999 | |
| Sixth formant bandwidth | B6 | Hz | 1000 | 200-2000 | |
| Nasal pole frequency | FNP | Hz | 250 | 200-500 | Fixed at 270 Hz typically |
| Nasal pole bandwidth | BNP | Hz | 100 | 50-500 | |
| Nasal zero bandwidth | BNZ | Hz | 100 | 50-500 | |
| Glottal resonator 2 bandwidth | BGS | Hz | 200 | 100-1000 | |
| Sampling rate | SR | Hz | 10000 | 5000-20000 | 10 kHz standard |
| Number of waveform samples per chunk | NWS | - | 50 | 1-200 | 50 = 5 msec at 10 kHz |
| Overall gain control | G0 | dB | 48 | 0-80 | |
| Number of cascaded formants | NFC | - | 5 | 4-6 | 5 typical for male |

## Rules/Algorithms

### General Procedure for Drawing Control Parameters (p. 116)
1. Draw the target value for the first segment
2. Draw the target value for the next segment
3. Smooth the boundary between segments using transition templates (DISCON, SETSMO, SMODIS, DISSMO)
4. Go to step 2 unless there are no more segments

### Transition Types (Figure 11-6, p. 117)
- **DISCON**: Discontinuous - no smoothing, step change at boundary
- **SETSMO**: Set-smooth - settable boundary values with smooth transitions on both sides
- **SMODIS**: Smooth-discontinuous - smooth approach to boundary, discontinuous after
- **DISSMO**: Discontinuous-smooth - discontinuous to boundary, smooth departure

### Voicing Source Generation
1. When F0 > 0 and AV > 0, impulse train at fundamental frequency
2. Impulse amplitude determined by AV (60 dB = strong vowel)
3. Impulses sent through low-pass filter RGP (resonator) to produce smooth glottal pulse
4. Antiresonator RGZ shapes spectrum (FGZ=0, BGZ=100 Hz typical)

### Quasi-Sinusoidal Voicing (AVS)
- Low-pass filter RGS with frequency = 0 produces -3 dB at BW/2
- BGS=200 Hz produces cutoff beyond which harmonics are strongly attenuated
- Spectrum: -24 dB/octave (vs -12 dB/octave for normal voicing)
- Use: breathy voice quality, voiced fricatives, voicebars in plosives

### Frication Source Generation
1. Pseudo-random number generator produces flat spectrum noise
2. Sum 16 random numbers for pseudo-Gaussian distribution
3. Low-pass filter LPF at -6 dB/octave
4. Amplitude controlled by AF parameter
5. For voiced fricatives: amplitude modulate at F0 with 50% modulation depth

### Plosive Burst Generation (p. 138)
- AF and AH interpolate noise intensity over 5 msec (50 samples)
- Plosive burst requires faster onset than 5 msec linear interpolation
- When AF increases by > 50 dB from previous frame: AF changes instantaneously
- Random number generator resets at plosive onset for predictable burst spectrum
- Value reset to produces flat burst spectrum

### Voice Onset Time Control (p. 138)
- VOT specified exactly in 5 msec steps (NWS=50)
- For finer control (e.g., 2 msec): set NWS=20
- In syllable "pa": closure (AV=0, F0=0), burst (AF~60, AH~40), aspiration (40 msec), voicing onset (AV=60, F0=130 Hz)

### Formant Amplitude Rules for Parallel Branch (p. 145-146)
1. Formant peaks equal for uniform tube (equal formant frequencies and bandwidths)
2. Amplitude inversely proportional to bandwidth (double BW = -6 dB)
3. Amplitude proportional to formant frequency (double F = +6 dB)
4. Changes to lower formant frequency affect higher formant amplitudes by frequency squared

### Nasalization Approximation (p. 120, 142)
- Increase F1 by ~100 Hz
- Set nasal zero FNZ = average of (new F1 value, 270 Hz)
- Nasal pole FNP fixed at 270 Hz
- Perceptually: reduction of F1 amplitude due to nearby pole-zero pair

## Figures of Interest

- **Fig 11-1 (p. 111):** Spectrum analysis of speech waveform showing linear prediction spectrum
- **Fig 11-2 (p. 112):** F1-F2 vowel plot for English vowels from speaker DHK - CRITICAL for vowel formant targets
- **Fig 11-3 (p. 113):** Linear prediction spectra of plosive bursts (BB, DD, GG) before front/back/rounded vowels - shows consonant context effects
- **Fig 11-4 (p. 114):** Locus plots for F1, F2, F3 at voicing onset for BB, DD, GG - demonstrates locus theory
- **Fig 11-5 (p. 115):** Synthesis strategy for CV syllable showing formant transitions - illustrates VTAR/DTAR targets
- **Fig 11-6 (p. 117):** Four transition templates (DISCON, SETSMO, SMODIS, DISSMO) - CRITICAL for parameter smoothing
- **Fig 11-7 (p. 120):** Constants for diphthong formant and duration synthesis (VTAR, DTAR, TCDIPH, TDMID, INHDUR)
- **Fig 12-1 (p. 123):** Interface between synthesizer software (CWTRAN+COEWAV) and hardware
- **Fig 12-2 (p. 125):** Components of speech output spectrum: Source -> Vocal Tract Transfer -> Radiation
- **Fig 12-3 (p. 126):** CASCADE vs PARALLEL configuration diagrams - CRITICAL architectural reference
- **Fig 12-4 (p. 127):** Cascade/parallel hybrid configurations supported by MITalk
- **Fig 12-5 (p. 129):** Digital resonator block diagram with A, B, C coefficients and frequency response showing BW
- **Fig 12-6 (p. 131):** Complete block diagram of cascade/parallel formant synthesizer - CRITICAL reference
- **Fig 12-7 (p. 135):** Normal vs smoothed voicing waveforms and spectra (-12 dB/oct vs -24 dB/oct)
- **Fig 12-8 (p. 137):** Frication noise waveform and spectrum
- **Fig 12-9 (p. 141):** Magnitude of vocal tract transfer function for uniform tube, IY, AA, UW
- **Fig 12-10 (p. 143):** Nasalization effect on vowel IH showing spectral changes
- **Fig 12-11 (p. 146):** Effect of parameter changes on transfer function: (a) uniform tube, (b) BW2 variations, (c) F1 variations, (d) interaction effects

## Tables of Interest

- **Table 11-1 (p. 119):** Parameter values for synthesis of vowels - F1, F2, F3, B1, B2, B3 for IY, IH, EY, EH, AE, AA, AO, AH, OW, UH, UW, ER, AY, AW, OY (two rows per vowel: target and diphthong endpoint)
- **Table 11-2 (p. 121):** Parameter values for consonants before front vowels - Sonorants (WW, YY, RR, LL), Fricatives (FF, VV, TH, DH, SS, ZZ, SH), Affricates (CH, JH), Plosives (PP, BB, TT, DD, KK, GG), Nasals (MM, NN)
- **Table 11-3 (p. 122):** Variable control parameters specified in PHONET - lists all 20 parameters output every 5 msec
- **Table 12-1 (p. 132):** Complete list of 39 control parameters with symbols, names, min/max/default values - CRITICAL reference

## Quotes Worth Preserving

> "The vowel identification rate was 99 percent and the consonant identification rate was 95 percent." (p. 114)

> "The transition between target values for each control parameter may either be discontinuous or smooth. The boundary value and transition duration in each direction from the logical phoneme boundary are computed by rules that take into account manner features of the segments involved." (p. 116)

> "Bandwidth values are often larger than closed-glottis values obtained by Fujimura and Lindqvist (1971), because the bandwidths of Table 11-1 have been adjusted to take into account changes to observed formant amplitudes caused by factors such as glottal losses and irregularities in the voicing source spectrum." (p. 116-118)

> "The cascade configuration is specially designed to model vocal tract characteristics for laryngeal sound sources, while fricatives require a parallel vocal tract configuration." (p. 137)

> "A plosive burst involves a more rapid source onset than can be achieved by 5 msec linear interpolation. Therefore, if AF increases by more than 50 dB from its value specified in the previous 5 msec segment, AF is (automatically) changed instantaneously to its new target value." (p. 138)

> "The amplitude of a formant peak is inversely proportional to its bandwidth. If a formant bandwidth is doubled, that formant peak is reduced in amplitude by 6 dB." (p. 146)

> "The amplitude of a formant peak is proportional to formant frequency. If a formant frequency is doubled, that formant peak is increased by 6 dB." (p. 146)

## Implementation Notes

### Critical Architecture Points
1. **Two-module design**: CWTRAN computes coefficients from parameters, COEWAV generates waveform samples
2. **Update rate**: Parameters updated every 5 msec (50 samples at 10 kHz)
3. **Hybrid cascade/parallel**: Voicing/aspiration through cascade, frication through parallel branch
4. **SW switch**: Controls cascade (0) vs all-parallel (1) mode

### Voicing Source Implementation
- Impulse generator triggered by F0 counter reaching period
- RGP low-pass filter (resonator) smooths impulses to glottal pulses
- RGZ antiresonator shapes spectrum
- RGS additional low-pass for quasi-sinusoidal voicing (AVS)
- Output spectrum: -12 dB/octave (normal) or -24 dB/octave (quasi-sinusoidal)

### Frication Source Implementation
- Pseudo-random number generator (sum of 16 randoms for Gaussian-like distribution)
- First-difference high-pass filter (radiation characteristic)
- LPF low-pass at -6 dB/octave
- Amplitude modulation at F0 for voiced fricatives (50% depth)
- AF=60 dB for strong fricative

### Plosive Burst Implementation
- AF > 50 dB jump triggers instantaneous onset (not 5 msec interpolation)
- Random number generator reset for predictable burst spectrum
- Burst duration: typically one 5 msec frame
- VOT controllable in 5 msec steps (or 2 msec with NWS=20)

### Nasal Implementation
- Cascade: RNP (nasal pole) and RNZ (nasal zero) in series after R1
- FNP fixed at 270 Hz, FNZ variable
- For nasalized vowels: increase F1 by 100 Hz, set FNZ = (F1_new + 270)/2
- Nasal murmur: AN amplitude in parallel branch, F1~480 Hz

### Formant Frequency Ranges (Male Talker DHK)
- F1: 180-750 Hz
- F2: 600-2300 Hz
- F3: 1300-3100 Hz
- F4: ~3500 Hz (relatively constant)
- F5: ~4500 Hz (relatively constant)

### Bandwidth Adjustments
- Bandwidths in tables are larger than acoustic measurements
- Account for glottal losses and source spectrum irregularities
- Voiced consonants: B1 wider than vowels
- Fricatives: different B1 for voiced (60 Hz) vs voiceless (200 Hz)

### Parallel Branch Amplitude Calculation
- Must account for cascade-like amplitude relationships
- A1-A5 set to produce equal formant peaks for uniform tube
- Adjust for bandwidth effects (-6 dB per doubling of BW)
- Adjust for frequency effects (+6 dB per doubling of F)
- Adjust for inter-formant coupling

### Voice Quality Control
- Normal voicing: AV only
- Breathy voice: AH=AV-3, AVS=AV-6 (example)
- Strong voicebar: AVS=47 (voiced plosive closure)
- Aspiration: AH=60, AV=0

## References to Other Chapters
- **Chapter 11** references **Appendix C** for complete description of PHONET rules
- **Chapter 12** references **Chapter 11** for phoneme target tables
- **Chapter 11** references **Klatt (1976a)** for original PHONET synthesis-by-rule program
- Figure 12-6 block diagram is central reference for synthesizer architecture
- Table 12-1 is the definitive parameter reference (39 parameters)
